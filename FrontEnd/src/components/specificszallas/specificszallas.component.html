<div
  class="min-h-screen w-full max-w-screen-2xl mx-auto p-4"
  *ngIf="szallasData"
>
  <div class="grid grid-cols-1 lg:grid-cols-3 gap-6">
    <!-- Bal oldal -->
    <div class="lg:col-span-2">
      <!-- Le√≠r√°s -->
      <div class="mb-6 p-6 bg-white rounded-lg shadow">
        <h1 class="text-3xl font-bold mb-2">{{ szallasData.name }}</h1>
        <h2 class="text-xl text-gray-600 mb-2">{{ szallasData.title }}</h2>
        <!-- Helysz√≠n -->
        <div class="p-6 bg-white rounded-lg flex space-x-4">
          <div class="flex items-start text-gray-700">
            <svg
              class="w-6 h-6 mr-2 mt-1 flex-shrink-0 text-orange-500"
              fill="currentColor"
              viewBox="0 0 20 20"
            >
              <path
                fill-rule="evenodd"
                d="M5.05 4.05a7 7 0 119.9 9.9L10 18.9l-4.95-4.95a7 7 0 010-9.9zM10 11a2 2 0 100-4 2 2 0 000 4z"
                clip-rule="evenodd"
              />
            </svg>
            <div>
              <p class="font-semibold">{{ szallasData.city }}</p>
              <p>{{ szallasData.street }}</p>
              <p class="text-sm text-gray-500">{{ szallasData.postal_code }}</p>
            </div>
          </div>
        </div>
        <!-- Gal√©ria -->
        <div class="mb-6">
          <!-- F≈ë k√©p -->
          <div class="mb-2">
            <img
              [src]="mainImage?.original || szallasData.cover_image"
              [alt]="szallasData.name"
              class="w-full h-96 object-cover rounded-lg cursor-pointer hover:opacity-90 transition"
              (click)="openGallery(0)"
            />
          </div>

          <!-- Thumbnail k√©pek -->
          <div
            class="grid grid-cols-3 gap-2"
            *ngIf="thumbnailImages.length > 0"
          >
            <img
              *ngFor="let img of thumbnailImages; let i = index"
              [src]="img.original"
              [alt]="img.image_title"
              class="w-full h-32 object-cover rounded-lg cursor-pointer hover:opacity-90 transition"
              (click)="openGallery(i + 1)"
            />
          </div>
        </div>

        <!-- Szolg√°ltat√°sok -->
      <div class="mb-6 p-6 bg-white rounded-lg shadow" *ngIf="features.length > 0">
        <h3 class="text-xl font-bold mb-4">Szolg√°ltat√°sok</h3>
        <div class="grid grid-cols-1 md:grid-cols-2 gap-3">
          <div
            *ngFor="let feature of features"
            class="flex items-start gap-3 p-3 rounded-lg hover:bg-gray-50 transition"
          >
            <app-feature-icon
              [iconKey]="feature.icon_key"
              className="w-6 h-6 flex-shrink-0 text-orange-500"
            ></app-feature-icon>
            <div class="flex-1">
              <h4 class="font-semibold text-sm text-gray-800">{{ feature.title }}</h4>
              <p class="text-xs text-gray-600 mt-1">{{ feature.shortDescription }}</p>
            </div>
          </div>
        </div>
      </div>

        <p class="text-gray-700 whitespace-pre-line">
          {{ szallasData.description }}
        </p>
      </div>

      <!-- √ârt√©kel√©s -->
      <div class="mb-6 p-6 bg-white rounded-lg shadow">
        <h3 class="text-xl font-bold mb-3">√ârt√©kel√©s</h3>
        <div class="flex items-center">
          <div
            class="bg-orange-500 text-white rounded-full w-16 h-16 flex items-center justify-center shadow-lg"
          >
            <span class="text-2xl font-bold">{{ szallasData.avgrating }}</span>
          </div>
          <span class="ml-4 text-lg text-gray-600">/ 10.0</span>
        </div>
      </div>

      
    </div>

    <!-- Jobb oldal - Foglal√°si panel -->
    <div class="lg:col-span-1">
      <div class="bg-white rounded-lg shadow-lg p-6 sticky top-4">
        <h3 class="text-2xl font-bold mb-4">Foglal√°s</h3>

        <!-- D√°tumv√°laszt√≥ gomb -->
        <div class="mb-4">
          <label class="block text-sm font-semibold text-gray-700 mb-2"
            >√ârkez√©s √©s t√°voz√°s</label
          >
          <button
            (click)="openCalendarPopup()"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg hover:border-orange-500 transition text-left"
          >
            <div class="flex justify-between items-center">
              <span class="text-gray-700">
                {{ checkInDate }} - {{ checkOutDate }}
              </span>
              <svg
                class="w-5 h-5 text-gray-400"
                fill="none"
                stroke="currentColor"
                viewBox="0 0 24 24"
              >
                <path
                  stroke-linecap="round"
                  stroke-linejoin="round"
                  stroke-width="2"
                  d="M8 7V3m8 4V3m-9 8h10M5 21h14a2 2 0 002-2V7a2 2 0 00-2-2H5a2 2 0 00-2 2v12a2 2 0 002 2z"
                />
              </svg>
            </div>
          </button>

          <p *ngIf="checkoutInfo" class="text-xs text-orange-600 mt-2">
            {{ checkoutInfo }}
          </p>
        </div>

        <!-- Utaz√≥k sz√°ma -->
        <div class="mb-6">
          <label class="block text-sm font-semibold text-gray-700 mb-2"
            >Utaz√≥k sz√°ma</label
          >
          <input
            type="number"
            [(ngModel)]="guests"
            (change)="onGuestsChange()"
            min="1"
            class="w-full px-4 py-2 border border-gray-300 rounded-lg focus:ring-2 focus:ring-orange-500 focus:border-transparent"
          />
        </div>

        <!-- √ñsszegz√©s -->
        <div class="border-t border-gray-200 pt-4 mb-6">
          <div class="flex justify-between mb-2 text-sm text-gray-600">
            <span
              >{{ szallasData.priceforone.toLocaleString() }} Ft √ó
              {{ nights }} √©j √ó {{ guests }} f≈ë</span
            >
          </div>
          <div class="flex justify-between items-center mt-4">
            <span class="text-xl font-bold">Teljes √°r</span>
            <span class="text-2xl font-bold text-orange-500"
              >{{ totalPrice.toLocaleString() }} Ft</span
            >
          </div>
        </div>

        <!-- Foglal√°s gomb -->
        <button
          (click)="makeReservation()"
          class="w-full bg-orange-500 hover:bg-orange-600 text-white font-bold py-3 px-6 rounded-lg transition duration-200"
        >
          Lefoglalom
        </button>

        <p class="text-xs text-gray-500 text-center mt-4">
          Tartalmazza az ad√≥kat √©s d√≠jakat
        </p>
      </div>
    </div>
  </div>
</div>

<!-- Calendar Popup -->

<div
  *ngIf="showCalendarPopup"
  class="fixed inset-0 bg-black bg-opacity-50 z-50 flex items-center justify-center p-4"
  (click)="closeCalendarPopup()"
>
  <div
    class="bg-white rounded-lg shadow-2xl max-w-screen-2xl w-full max-h-[90vh] overflow-auto"
    (click)="$event.stopPropagation()"
  >
    <div
      class="sticky top-0 bg-white border-b border-gray-200 px-6 py-4 flex justify-between items-center z-10"
    >
      <div class="flex items-center space-x-4">
        <h2 class="text-2xl font-bold text-gray-800">{{ calendarTitle }}</h2>
        <button
          (click)="resetSelection()"
          class="bg-gray-500 hover:bg-gray-600 text-white rounded-lg px-3 py-1 text-sm transition"
        >
          T√∂rl√©s
        </button>
      </div>
      <button
        (click)="closeCalendarPopup()"
        class="bg-red-500 hover:bg-red-600 text-white rounded-lg p-2 transition"
      >
        <svg
          class="w-6 h-6"
          fill="none"
          stroke="currentColor"
          viewBox="0 0 24 24"
        >
          <path
            stroke-linecap="round"
            stroke-linejoin="round"
            stroke-width="2"
            d="M6 18L18 6M6 6l12 12"
          />
        </svg>
      </button>
    </div>

    <div class="p-6">
      <full-calendar
        [options]="calendarOptions"
        class="col-span-full"
      ></full-calendar>

      <div class="mt-6 flex flex-wrap gap-4 justify-center">
        <div class="flex items-center">
          <div class="text-2xl mr-2">üü¢</div>
          <span class="text-sm font-semibold text-gray-700"
            >Sok szabad szoba (3+)</span
          >
        </div>
        <div class="flex items-center">
          <div class="text-2xl mr-2">üü°</div>
          <span class="text-sm font-semibold text-gray-700"
            >Kev√©s szoba (1-2)</span
          >
        </div>
        <div class="flex items-center">
          <div class="text-2xl mr-2">üî¥</div>
          <span class="text-sm font-semibold text-gray-700">Telt h√°z</span>
        </div>
        <div class="flex items-center">
          <div
            class="w-6 h-6 bg-orange-500 rounded mr-2 border-2 border-orange-700"
          ></div>
          <span class="text-sm font-semibold text-gray-700"
            >√ârkez√©s/T√°voz√°s</span
          >
        </div>
        <div class="flex items-center">
          <div class="w-6 h-6 bg-orange-500 rounded mr-2"></div>
          <span class="text-sm font-semibold text-gray-700"
            >Kiv√°lasztott id≈ëszak</span
          >
        </div>
        <div class="flex items-center">
          <div class="w-6 h-6 bg-orange-200 rounded mr-2"></div>
          <span class="text-sm font-semibold text-gray-700"
            >Lehets√©ges t√°voz√°si napok</span
          >
        </div>
        <div class="flex items-center">
          <div
            class="w-6 h-6 bg-green-300 rounded mr-2 border-2 border-orange-600"
          ></div>
          <span class="text-sm font-semibold text-orange-600">Mai nap</span>
        </div>
      </div>

      <div class="mt-6 text-center">
        <button
          (click)="closeCalendarPopup()"
          class="bg-orange-500 hover:bg-orange-600 text-white font-bold py-2 px-6 rounded-lg transition"
        >
          Bez√°r√°s
        </button>
      </div>
    </div>
  </div>
</div>

<!-- Gal√©ria modal -->
<div
  *ngIf="showGallery && images.length > 0"
  class="fixed inset-0 bg-transparent backdrop-blur-xl bg-opacity-50 z-50 flex items-center justify-center"
  (click)="closeGallery()"
>
  <button
    class="absolute top-8 right-12 bg-red-400 w-10 h-10 text-red-900 text-4xl hover:text-red-300 z-10"
    (click)="closeGallery()"
  >
    &times;
  </button>

  <button
    class="absolute left-4 text-white text-4xl hover:text-gray-300 z-10 bg-black/50 h-56 w-10"
    (click)="prevImage(); $event.stopPropagation()"
    *ngIf="images.length > 1"
  >
    &#8249;
  </button>

  <img
    [src]="images[currentImageIndex]?.original"
    [alt]="images[currentImageIndex]?.image_title"
    class="max-h-[90vh] max-w-[90vw] object-contain"
    (click)="$event.stopPropagation()"
  />

  <button
    class="absolute right-4 text-white text-4xl hover:text-gray-300 z-10 bg-black/50 h-56 w-10"
    (click)="nextImage(); $event.stopPropagation()"
    *ngIf="images.length > 1"
  >
    &#8250;
  </button>

  <div class="absolute bottom-4 text-white text-lg">
    {{ currentImageIndex + 1 }} / {{ images.length }}
  </div>
</div>
